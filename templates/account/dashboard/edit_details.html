{% extends "account/sub_base.html" %}
{% block title %}Edit Profile{% endblock %}
{% block sub_content %}

<h3>Change your details</h3>
<p>You can edit your information using the following form:</p>
<hr>
<form class="account-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% if user_form.errors %}
    <p>Please correct the following errors:</p>
    {% for user_field in user_form %}
    {% if user_field.errors %}
    <div class="alert alert-primary" role="alert">
        {{ user_field.label }}: {{ user_field.errors|striptags }}
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}
    {% if address_form.errors %}
    <p>Please correct the following errors:</p>
    {% for address_field in  address_form %}
    {% if address_field.errors %}
    <div class="alert alert-primary" role="alert">
        {{ address_field.label }}: {{ address_field.errors|striptags }}
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}

    <div style="display:flex; flex-direction:column;">
        <div>
            <label class="small font-weight-bold">{{ user_form.profile_img.label}}</label>
        </div>
        <div>
            {{ user_form.profile_img }}
        </div>
    </div>
    <label class="small font-weight-bold">{{ user_form.email.label}}</label>
    {{ user_form.email }}
    <label class="small font-weight-bold">{{ user_form.user_name.label}}</label>
    {{ user_form.user_name }}
    <label class="small font-weight-bold">{{ user_form.first_name.label}}</label>
    {{ user_form.first_name }}
    <label class="small font-weight-bold">{{ user_form.last_name.label}}</label>
    {{ user_form.last_name }}

    {% comment %} address {% endcomment %}
    <label class="small font-weight-bold">{{ address_form.phone.label}}</label>
    {{ address_form.phone }}
    <label class="small font-weight-bold">{{ address_form.country.label}}</label>
    {{ address_form.country }}
    <label class="small font-weight-bold">{{ address_form.town_city.label}}</label>
    {{ address_form.town_city }}
    <label class="small font-weight-bold">{{ address_form.postcode.label}}</label>
    {{ address_form.postcode }}
    <label class="small font-weight-bold">{{ address_form.address_line.label}}</label>
    {{ address_form.address_line }}
    <label class="small font-weight-bold">{{ address_form.address_line2.label}}</label>
    {{ address_form.address_line2 }}

    {% comment %} about you {% endcomment %}
    <label class="small font-weight-bold">{{ user_form.about.label}}</label>
    {{ user_form.about }}


    <button class="btn btn-primary btn-block py-2 mb-4 mt-5 fw-bold w-100" type="submit" value="Save changes">Save
        Changes</button>
    <hr class="mb-3">
</form>
<div>
    <p class=" h3 pt-4 font-weight-bold">Delete Account</p>
    <p>Are you sure you want to delete your account?</p>
    <button id="delete-user" type="submit" role="button"
        class="btn btn-danger btn-block py-2 mb-4 mt-5 fw-bold w-100">Delete</button>
</div>

<script>
    $(document).on('click', '#delete-user', function (e) {
        $.ajax({
            headers: {
                'X-CSRFTOKEN': '{{ csrf_token }}',
            },
            type: 'PATCH',
            url: '{% url "account:edit_details" %}',
            data: {
                action: 'deletet-user'
            },
            success: function (json) {
                window.location = '{% url "account:delete_confirmation" %}'
            },
            error: function (xhr, errmsg, err) {

            }
        });

    })
</script>

{% endblock %}